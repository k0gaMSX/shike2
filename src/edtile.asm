
	INCLUDE	BIOS.INC
	INCLUDE	SHIKE2.INC
	INCLUDE	LEVEL.INC
	INCLUDE	EVENT.INC

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	PUBLIC	EDTILE
	EXTRN	EDINIT,VDPSYNC,LISTEN,CARTPAGE

EDTILE:	CALL	EDINIT

ED.LOOP:LD	E,LEVELPAGE
	CALL	CARTPAGE
	CALL	SHOWSCR
	CALL	VDPSYNC
	LD	DE,RECEIVERS
	CALL	LISTEN
	JR	NZ,ED.LOOP
	RET

RECEIVERS:
	DB	80,30,30,8
	DW	CHANGETILE
	DB	80,30,38,8
	DW	CHANGEPAL
	DB	80,30,46,8
	DW	CHANGESET
	DB	80,16,78,8
	DW	PUTPATTERN1
	DB	80,16,86,8
	DW	PUTPATTERN2
	DB	80,16,94,8
	DW	PUTPATTERN3
	DB	80,16,102,8
	DW	PUTPATTERN4
	DB	80,16,110,8
	DW	PUTPATTERN5
	DB	80,16,118,8
	DW	PUTPATTERN6
	DB	80,30,142,8
	DW	CHANGEHEIGHT
	DB	0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	EXTRN	PRINTF,LOCATE,GLINES

SHOWSCR:LD	DE,0
	CALL	LOCATE

	LD	H,0
	LD	A,(HEIGHT)
	LD	L,A
	PUSH	HL
	LD	A,(NUMPAT6)
	LD	L,A
	PUSH	HL
	LD	A,(NUMPAT5)
	LD	L,A
	PUSH	HL
	LD	A,(NUMPAT4)
	LD	L,A
	PUSH	HL
	LD	A,(NUMPAT3)
	LD	L,A
	PUSH	HL
	LD	A,(NUMPAT2)
	LD	L,A
	PUSH	HL
	LD	A,(NUMPAT1)
	LD	L,A
	PUSH	HL
	LD	A,(SET)
	LD	L,A
	PUSH	HL
	LD	A,(PAL)
	LD	L,A
	PUSH	HL
	LD	A,(TILE)
	LD	L,A
	PUSH	HL
	LD	DE,FMT
	CALL	PRINTF			;PRINT THE TEXT INFORMATION

	LD	DE,TILEG
	LD	C,15
	JP	GLINES


;	       REP  X0  Y0    X1  Y1 IX0 IY0 IX1 IY1
TILEG:	DB	4,  80, 30,  110, 30,  0,  8,  0,  8
	DB	2,  80, 30,   80, 54, 30,  0, 30,  0
	DB	7,  80, 78,   96, 78,  0,  8,  0,  8
	DB	2,  80, 78,   80,126, 16,  0, 16,  0
	DB	2,  80,142,  110,142,  0,  8,  0,  8
	DB	2,  80,142,   80,150, 30,  0, 30,  0
	DB	0

FMT:	DB	10,10,10,10
	DB	9,9,"     TILE",9,"%03d",10
	DB	9,9,"     PALETE",9,"%3d",10
	DB	9,9,"     SET",9,"%3d",10
	DB	10,10,10
	DB	9,9,9," %d",10
	DB	9,9,9," %d",10
	DB	9,9,9," %d",10
	DB	9,9,9," %d",10
	DB	9,9,9," %d",10
	DB	9,9,9," %d",10
	DB	10,10
	DB	9,9,"     HEIGHT",9,"%3d",0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;INPUT:	A = EVENT

	CSEG

CHANGETILE:
	CP	MS_BUTTON1		;BUTTON 1 INCREMENT TILE NUMBER
	LD	A,(TILE)
	JR	NZ,F.DEC
	INC	A
	JR	F.RET

F.DEC:	DEC	A			;BUTTON 2 DECREMENT TILE NUMBER
F.RET:	LD	(TILE),A
	RET

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;INPUT: A = EVENT

	CSEG

CHANGEPAL:
	CP	MS_BUTTON1		;BUTTON 1 INCREMENT PALETE NUMBER
	LD	A,(PAL)
	JR	NZ,P.DEC
	CP	NR_PALETES-1
	RET	Z
	INC	A
	JR	P.RET

P.DEC:	OR	A			;BUTTON 2 DECREMENT PALETE NUMBER
	RET	Z
	DEC	A
P.RET:	LD	(PAL),A
	RET



CHANGESET:
CHANGEHEIGHT:
PUTPATTERN1:
PUTPATTERN2:
PUTPATTERN3:
PUTPATTERN4:
PUTPATTERN5:
PUTPATTERN6:
	RET


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	DSEG
TILE:	DB	0
SET:	DB	0
PAL:	DB	0
NUMPAT1:DB	0
NUMPAT2:DB	0
NUMPAT3:DB	0
NUMPAT4:DB	0
NUMPAT5:DB	0
NUMPAT6:DB	0
HEIGHT:	DB	0

