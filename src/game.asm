
	INCLUDE	SHIKE2.INC
	INCLUDE	KBD.INC

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	PUBLIC	GAME
	EXTRN	CLRSPR,LEVELINIT,MOBINIT,MOVINIT,NEWFRAME
	EXTRN	DISSCR,TURNOFF,NEWMOV,SETCAMERA

GAME:   CALL	DISSCR
	CALL	TURNOFF
	CALL	CLRSPR
	CALL	LEVELINIT
	CALL	MOBINIT
	CALL	MOVINIT

	LD	A,1
	LD	(ENAGRID),A
	LD	(ENAMAP),A
	LD	(ENALIMITS),A
	LD	(ENAHEIGTHS),A

	LD	IX,MOV1
	LD	DE,POINT1
	LD	C,1
	CALL	NEWMOV

	LD	IX,MOV2
	LD	DE,POINT2
	LD	C,0
	CALL	NEWMOV

	LD	DE,MOV1
	CALL	SETCAMERA

G.LOOP: CALL	NEWFRAME
	CALL	GETKEY
	CP	KB_ESC
	JR	NZ,G.LOOP
	RET


POINT1:	DB	0		;LEVEL=0
	DW	0000H		;ROOM=0
	DB	0,0,0		;Y=X=Z=0

POINT2:	DB	0		;LEVEL=0
	DW	0100H		;ROOM=1
	DB	15,0,0		;Y=15,X=Z=0

	DSEG
MOV1:	DS	50		;TODO: TEMPORAL BUFFER
MOV2:	DS	50		;TODO: TEMPORAL BUFFER

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	EXTRN	KBHIT,ENAMAP,ENAGRID,ENALIMITS,ENAHEIGTHS,CHGCAMERA

GETKEY:	CALL	KBHIT
	RET	Z

	LD	(G.KEY),A
	CP	KB_F1
	JR	NZ,G.F2
	LD	A,(ENAGRID)
	XOR	1
	LD	(ENAGRID),A
	JR	G.RET

G.F2:	CP	KB_F2
	JR	NZ,G.F3
	LD	A,(ENAMAP)
	XOR	1
	LD	(ENAMAP),A
	JR	G.RET

G.F3:	CP	KB_F3
	JR	NZ,G.F4
	LD	A,(ENALIMITS)
	XOR	1
	LD	(ENALIMITS),A
	JR	G.RET

G.F4:	CP	KB_F4
	RET	NZ
	LD	A,(ENAHEIGTHS)
	XOR	1
	LD	(ENAHEIGTHS),A

G.RET:	LD	IX,MOV1
	CALL	CHGCAMERA
	LD	A,(G.KEY)
	RET

	DSEG
G.KEY:	DB	0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	PUBLIC	ENGINE

ENGINE:	RET

