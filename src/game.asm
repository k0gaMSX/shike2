
	INCLUDE	BIOS.INC
	INCLUDE	DATA.INC

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	PUBLIC	GAME
	EXTRN	KPRESS,VDPSYNC,SETPAGE,NEWFRAME,KBHIT,MOB,PUTMOB,EDITOR,MOBINIT
	EXTRN	LOCATE

	INCLUDE	EVENT.INC

GAME:	CALL	MOBINIT
	CALL	EDITOR

	EXTRN	CPVPAGE,CLRVPAGE,LOCATE
	LD	E,0
	;CALL	CLRVPAGE
	LD	E,0
	LD	C,1
	CALL	CPVPAGE
	CALL	VDPSYNC

	XOR	A
	LD	(DPPAGE),A
	INC	A
	LD	(ACPAGE),A
	CALL	SETPAGE

	LD	HL,0
	LD	(X1),HL
	LD	(X2),HL

	LD	IX,MOB1
	CALL	MOB
	LD	IX,MOB2
	CALL	MOB

G.LOOP:	LD	DE,(ACPAGE)
	;CALL	CLRVPAGE
	LD	DE,6
	CALL	LOCATE
	LD	HL,(DPPAGE)
	LD	H,0
	PUSH	HL
	LD	DE,G.STR
	CALL	PDEBUG
	CALL	NEWFRAME
	CALL	VDPSYNC
	CALL	KPRESS
	CP	KB_ESC
	JR	NZ,G.LOOP
	RET

G.STR:	"DPPAGE: %d",10,0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	PUBLIC	ENGINE

ENGINE:	LD	IX,MOB1
	LD	A,(X1)
	LD	L,A
	LD	H,0
	DEC	A
	LD	(X1),A
	LD	DE,10
	LD	B,0
	CALL	PUTMOB

	LD	IX,MOB2
	LD	A,(X2)
	LD	L,A
	LD	H,0
	INC	A
	LD	(X2),A
	LD	DE,0
	LD	B,0
	CALL	PUTMOB
	RET

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	PUBLIC	PDEBUG
	EXTRN	VDPPAGE

PDEBUG:	POP	HL
	LD	(P.RET),HL
	LD	A,(ACPAGE)
	LD	(P.PAGE1),A
	LD	A,(DPPAGE)
	LD	(ACPAGE),A
	LD	A,(VDPPAGE)
	LD	(P.PAGE2),A
	LD	A,(LOGOP)
	LD	(P.LOGOP),A
	CALL	PRINTF
	CALL	VDPSYNC
	LD	A,(P.PAGE1)
	LD	(ACPAGE),A
	LD	A,(P.PAGE2)
	LD	(VDPPAGE),A
	LD	A,(P.LOGOP)
	LD	(LOGOP),A
	LD	HL,(P.RET)
	JP	(HL)
	
	DSEG
P.PAGE1:DB	0
P.PAGE2:DB	0
P.LOGOP:DB	0
P.RET:	DW	0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	CSEG
	PUBLIC	PMOB
	EXTRN	PUTCHAR,PRINTF

PMOB:	LD	A,10
	JP	PUTCHAR
	LD	IX,MOB2
	LD	H,0
	LD	L,(IX+MOB.YESIZ)
	PUSH	HL
	LD	L,(IX+MOB.XESIZ)
	PUSH	HL
	LD	L,(IX+MOB.YE)
	PUSH	HL
	LD	L,(IX+MOB.XE)
	PUSH	HL

	LD	L,(IX+MOB.YDSIZ)
	PUSH	HL
	LD	L,(IX+MOB.XDSIZ)
	PUSH	HL
	LD	L,(IX+MOB.YD)
	PUSH	HL
	LD	L,(IX+MOB.XD)
	PUSH	HL

	LD	L,(IX+MOB.YSIZ)
	PUSH	HL
	LD	L,(IX+MOB.XSIZ)
	PUSH	HL
	LD	L,(IX+MOB.Y)
	PUSH	HL
	LD	L,(IX+MOB.X)
	PUSH	HL
	LD	DE,PSTR
	CALL	PDEBUG
	RET

PSTR:	9,"X =%03d,Y =%03d,XSIZ =%02d,YSIZ =%02d",10
	9,"XD=%03d,YD=%03d,XDSIZ=%02d,YDSIZ=%02d",10
	9,"XE=%03d,YE=%03d,XESIZ=%02d,YESIZ=%02d",10,0

	DSEG
MOB1:	DS	MOB.SIZ
MOB2:	DS	MOB.SIZ
X1:	DW	0
X2:	DW	0

